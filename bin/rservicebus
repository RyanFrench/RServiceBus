#!/usr/bin/env ruby
#
# The application 'rservicebus' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require 'rubygems'
require 'optparse'
require 'rservicebus'

def run_rservicebus(configFilePath)
	RServiceBus::Host.new()
		.loadConfig(configFilePath)
		.loadHandlers()
		.loadSubscriptions()
		.sendSubscriptions()
		.run()
end

# This hash will hold all of the options
# parsed from the command-line by
# OptionParser.
options = {}
 
optparse = OptionParser.new do|opts|
   # Set a banner, displayed at the top
   # of the help screen.
   opts.banner = "Usage: rservicebus [options]"

   # Define the options, and what they do
   options[:config] = nil
   opts.on( '-c', '--config FILE', 'Path tp configuration FILE' ) do |file|
     options[:config] = file
   end

   # This displays the help screen, all programs are
   # assumed to have this option.
   opts.on( '-h', '--help', 'Display this screen' ) do
     puts opts
     exit
   end
end
optparse.parse!

run_rservicebus(options[:config])
